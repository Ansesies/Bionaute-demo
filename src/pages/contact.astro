---
import Layout from '../layouts/Layout.astro';
---

<Layout>
  <div class="pt-16 md:pt-20"> <!-- Espacio para el header fijo -->
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-emerald-900 to-teal-800 py-16 md:py-24">
      <div class="container mx-auto px-4 md:px-6 text-center">
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-white mb-8 animate-fadeIn opacity-0" style="animation: fadeIn 0.8s ease-out forwards 0.2s;">
          Contacto
        </h1>
        <div class="max-w-3xl mx-auto">
          <p class="text-lg md:text-xl text-green-50 mb-6 animate-fadeIn opacity-0" style="animation: fadeIn 0.8s ease-out forwards 0.4s;">
            Póngase en contacto con nuestro equipo de expertos en biotecnología agrícola. 
            Estamos aquí para ayudarle a optimizar sus cultivos con soluciones innovadoras.
          </p>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <section class="py-16 md:py-24 bg-gray-50">
      <div class="container mx-auto px-4 md:px-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
          
          <!-- Contact Information -->
          <div class="animate-element">
            <h2 class="text-2xl md:text-3xl font-bold text-emerald-800 mb-8">Información de Contacto</h2>
            
            <div class="space-y-8">
              <!-- Office Address -->
              <div class="border-l-4 border-emerald-600 pl-6">
                <h3 class="text-lg font-semibold text-emerald-800 mb-2">Oficina Principal</h3>
                <p class="text-gray-600 mb-1">Avenida Agricultura 1250</p>
                <p class="text-gray-600 mb-1">Santiago, Chile</p>
                <p class="text-gray-600">Código Postal: 8320000</p>
              </div>

              <!-- Phone -->
              <div class="border-l-4 border-teal-600 pl-6">
                <h3 class="text-lg font-semibold text-emerald-800 mb-2">Teléfono</h3>
                <p class="text-gray-600 text-lg">+56 2 2123 4567</p>
                <p class="text-gray-500 text-sm">Lunes a Viernes, 9:00 - 18:00</p>
              </div>

              <!-- Email -->
              <div class="border-l-4 border-emerald-500 pl-6">
                <h3 class="text-lg font-semibold text-emerald-800 mb-2">Correo Electrónico</h3>
                <p class="text-gray-600">
                  <a href="mailto:contacto@bionaute.cl" class="text-emerald-600 hover:text-emerald-800 transition-colors">
                    contacto@bionaute.cl
                  </a>
                </p>
                <p class="text-gray-600">
                  <a href="mailto:ventas@bionaute.cl" class="text-emerald-600 hover:text-emerald-800 transition-colors">
                    ventas@bionaute.cl
                  </a>
                </p>
              </div>
            </div>
          </div>

          <!-- Contact Form -->
          <div class="animate-element">
            <div class="bg-white border border-gray-200 rounded-xl shadow-lg p-8">
              <h2 class="text-2xl md:text-3xl font-bold text-emerald-800 mb-8">Envíenos un Mensaje</h2>
              
              <form class="space-y-6">
                <!-- Name and Company -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label for="nombre" class="block text-sm font-medium text-gray-700 mb-2">
                      Nombre Completo *
                    </label>
                    <input 
                      type="text" 
                      id="nombre" 
                      name="nombre" 
                      required
                      class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                      placeholder="Su nombre completo"
                    >
                  </div>
                  
                  <div>
                    <label for="empresa" class="block text-sm font-medium text-gray-700 mb-2">
                      Empresa
                    </label>
                    <input 
                      type="text" 
                      id="empresa" 
                      name="empresa" 
                      class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                      placeholder="Nombre de su empresa"
                    >
                  </div>
                </div>

                <!-- Email and Phone -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                      Correo Electrónico *
                    </label>
                    <input 
                      type="email" 
                      id="email" 
                      name="email" 
                      required
                      class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                      placeholder="su@correo.com"
                    >
                  </div>
                  
                  <div>
                    <label for="telefono" class="block text-sm font-medium text-gray-700 mb-2">
                      Teléfono
                    </label>
                    <input 
                      type="tel" 
                      id="telefono" 
                      name="telefono" 
                      class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                      placeholder="+56 9 1234 5678"
                    >
                  </div>
                </div>

                <!-- Subject -->
                <div>
                  <label for="asunto" class="block text-sm font-medium text-gray-700 mb-2">
                    Asunto *
                  </label>
                  <select 
                    id="asunto" 
                    name="asunto" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                  >
                    <option value="">Seleccione un asunto</option>
                    <option value="consulta-general">Consulta General</option>
                    <option value="solicitud-cotizacion">Solicitud de Cotización</option>
                    <option value="soporte-tecnico">Soporte Técnico</option>
                    <option value="partnerships">Partnerships</option>
                    <option value="otros">Otros</option>
                  </select>
                </div>

                <!-- Crop Type -->
                <div>
                  <label for="tipo_cultivo" class="block text-sm font-medium text-gray-700 mb-2">
                    Tipo de Cultivo
                  </label>
                  <select 
                    id="tipo_cultivo" 
                    name="tipo_cultivo" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                  >
                    <option value="">Seleccione el tipo de cultivo</option>
                    <option value="uva">Uva</option>
                    <option value="arandanos">Arándanos</option>
                    <option value="citricos">Cítricos</option>
                    <option value="paltos">Paltos</option>
                    <option value="cereales">Cereales</option>
                    <option value="hortalizas">Hortalizas</option>
                    <option value="frutales">Frutales</option>
                    <option value="otro">Otro</option>
                  </select>
                </div>

                <!-- Message -->
                <div>
                  <label for="mensaje" class="block text-sm font-medium text-gray-700 mb-2">
                    Mensaje *
                  </label>
                  <textarea 
                    id="mensaje" 
                    name="mensaje" 
                    rows="5" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors resize-none"
                    placeholder="Describa su consulta o requerimiento..."
                  ></textarea>
                </div>

                <!-- Privacy Policy -->
                <div class="flex items-start">
                  <input 
                    type="checkbox" 
                    id="privacidad" 
                    name="privacidad" 
                    required
                    class="mt-1 h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300 rounded"
                  >
                  <label for="privacidad" class="ml-3 text-sm text-gray-600">
                    Acepto la <a href="#" class="text-emerald-600 hover:text-emerald-800">política de privacidad</a> 
                    y el tratamiento de mis datos personales. *
                  </label>
                </div>

                <!-- Submit Button -->
                <div class="pt-4">
                  <button 
                    type="submit" 
                    class="w-full bg-gradient-to-r from-emerald-600 to-teal-500 text-white py-3 px-6 rounded-md font-medium hover:from-emerald-700 hover:to-teal-600 focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition-all duration-300 shadow-lg hover:shadow-emerald-500/50 transform hover:-translate-y-1"
                  >
                    Enviar Mensaje
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Map Section -->
    <section class="py-16 md:py-24 bg-white">
      <div class="container mx-auto px-4 md:px-6">
        <div class="text-center mb-12 animate-element">
          <h2 class="text-2xl md:text-3xl font-bold text-emerald-800 mb-4">Nuestra Ubicación</h2>
          <p class="text-lg text-gray-600">
            Visítenos en nuestras oficinas centrales en Santiago, Chile
          </p>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg overflow-hidden animate-element">
          <div class="h-96">
            <iframe 
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3329.954497836127!2d-70.6667!3d-33.4489!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMzPCsDI2JzU2LjAiUyA3MMKwNDAnMDAuMCJX!5e0!3m2!1ses!2scl!4v1622584862340!5m2!1ses!2scl" 
              width="100%" 
              height="100%" 
              style="border:0;" 
              allowfullscreen=""
              loading="lazy"
              title="Ubicación de Bionaute">
            </iframe>
          </div>
        </div>
      </div>
    </section>
  </div>
</Layout>

<style>
  /* Animaciones para la página de contacto */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(40px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .animate-element {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.22, 1, 0.36, 1);
    will-change: transform, opacity;
  }
  
  .animate-element.in-view {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Professional form styling */
  input:focus, select:focus, textarea:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
  }
  
  /* Smooth transitions */
  a, button {
    transition: all 0.3s ease;
  }
  
  /* Professional button styling */
  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }
  
  /* Professional borders with emerald colors */
  .border-l-4 {
    position: relative;
  }
  
  .border-l-4::before {
    content: '';
    position: absolute;
    left: -4px;
    top: 0;
    bottom: 0;
    width: 4px;
    border-radius: 2px;
  }
  
  /* Animación secuencial para elementos */
  .animate-element:nth-child(1).in-view { transition-delay: 0s; }
  .animate-element:nth-child(2).in-view { transition-delay: 0.2s; }
  .animate-element:nth-child(3).in-view { transition-delay: 0.4s; }
</style>

<script>
  let contactObserver: IntersectionObserver | null = null;

  // Declaraciones TypeScript para funciones del window
  declare global {
    interface Window {
      isMobile?: () => boolean;
      isIOS?: () => boolean;
      getMobileDelay?: () => number;
      iOSFixes?: {
        isInBackground: boolean;
        activeObservers: Array<{observer: IntersectionObserver, pageName: string}>;
        registerObserver: (observer: IntersectionObserver, pageName: string) => void;
        cleanup: () => void;
      };
    }
  }

  // Función para manejar intersección
  function handleIntersection(entries: IntersectionObserverEntry[]) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('in-view');
      }
    });
  }

  // Función para limpiar animaciones previas
  function resetContactAnimations() {
    // Remover clases de animación existentes
    document.querySelectorAll('.animate-element').forEach(element => {
      element.classList.remove('in-view');
    });
    
    // Desconectar observer anterior si existe
    if (contactObserver) {
      contactObserver.disconnect();
    }
  }

  // Función para configurar animaciones
  function setupContactAnimation() {
    // Limpiar animaciones previas
    resetContactAnimations();
    
    // Configuración específica para móviles e iOS
    const isMobileDevice = window.isMobile ? window.isMobile() : false;
    const isIOSDevice = window.isIOS ? window.isIOS() : false;
    
    const observerConfig = {
      threshold: isMobileDevice ? (isIOSDevice ? 0.02 : 0.05) : 0.1,
      rootMargin: isMobileDevice ? 
        (isIOSDevice ? '50px 0px 50px 0px' : '0px 0px -5% 0px') : 
        '0px 0px -10% 0px'
    };
    
    // Crear nuevo observer
    contactObserver = new IntersectionObserver(handleIntersection, observerConfig);

    // Registrar en iOS system si está disponible
    if (isIOSDevice && window.iOSFixes) {
      window.iOSFixes.registerObserver(contactObserver, 'contact');
    }

    // Observar elementos
    document.querySelectorAll('.animate-element').forEach(element => {
      if (contactObserver) {
        contactObserver.observe(element);
      }
    });
  }

  // Función para inicializar la página
  function initializeContactPage() {
    // Delay específico para el tipo de dispositivo
    const delay = window.getMobileDelay ? window.getMobileDelay() : 100;
    setTimeout(setupContactAnimation, delay);
  }

  // Función para limpiar al salir de la página
  function cleanupContactPage() {
    if (contactObserver) {
      contactObserver.disconnect();
      contactObserver = null;
    }
  }

  // Función de inicialización robusta para móviles
  function robustContactInit() {
    if (window.isMobile && window.isMobile()) {
      let attempts = 0;
      const maxAttempts = 3;
      
      function tryInit() {
        attempts++;
        if (document.readyState === 'complete') {
          initializeContactPage();
        } else if (attempts < maxAttempts) {
          setTimeout(tryInit, 50);
        } else {
          initializeContactPage();
        }
      }
      
      tryInit();
    } else {
      initializeContactPage();
    }
  }

  // Handlers específicos para iOS
  function handleiOSPause() {
    if (contactObserver) {
      contactObserver.disconnect();
    }
  }

  function handleiOSReactivate() {
    setTimeout(setupContactAnimation, 200);
  }

  function handleiOSScrollEnd() {
    if (contactObserver && window.isIOS && window.isIOS()) {
      document.querySelectorAll('.animate-element').forEach(element => {
        if (!element.classList.contains('in-view')) {
          const rect = element.getBoundingClientRect();
          const windowHeight = window.innerHeight;
          if (rect.top < windowHeight * 0.8 && rect.bottom > windowHeight * 0.2) {
            element.classList.add('in-view');
          }
        }
      });
    }
  }

  // Inicializar cuando el DOM está listo
  document.addEventListener('DOMContentLoaded', robustContactInit);
  
  // Re-inicializar en eventos de Astro
  document.addEventListener('astro:page-load', robustContactInit);
  
  // Limpiar antes de las transiciones
  document.addEventListener('astro:before-preparation', cleanupContactPage);
  
  // Para dispositivos móviles - listener adicional
  if (window.isMobile && window.isMobile()) {
    window.addEventListener('load', () => {
      setTimeout(robustContactInit, window.getMobileDelay ? window.getMobileDelay() : 150);
    });
  }

  // Listeners específicos para iOS
  if (window.isIOS && window.isIOS()) {
    window.addEventListener('ios-pause-observers', handleiOSPause);
    window.addEventListener('ios-reactivate-observers', handleiOSReactivate);
    window.addEventListener('ios-scroll-end', handleiOSScrollEnd);
  }
</script>